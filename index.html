<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MANDEVAL ‚Äì Vaccine Mandate Decision Aid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="styles.css">

  <!-- Libraries for charts and exports -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script src="script.js" defer></script>
</head>
<body>
  <header class="app-header">
    <div class="app-header-inner">
      <div class="app-title-block">
        <h1 class="app-title">MANDEVAL</h1>
        <p class="app-subtitle">Vaccine mandate evaluation tool ‚Äì Australia, France, Italy</p>
      </div>
      <div class="app-header-meta">
        <span class="app-badge">Version 1.0</span>
        <a href="technical-appendix.html" target="_blank" rel="noopener noreferrer" class="link-plain">
          Technical appendix
        </a>
      </div>
    </div>
  </header>

  <nav class="tab-bar" aria-label="Main navigation">
    <button class="tab-link active" data-tab="introTab" type="button">Introduction</button>
    <button class="tab-link" data-tab="designTab" type="button">Mandate design features</button>
    <button class="tab-link" data-tab="settingsTab" type="button">Settings & assumptions</button>
    <button class="tab-link" data-tab="configTab" type="button">Configuration</button>
    <button class="tab-link" data-tab="costsTab" type="button">Costing</button>
    <button class="tab-link" data-tab="resultsTab" type="button">Results & MRS</button>
    <button class="tab-link" data-tab="scenariosTab" type="button">Saved scenarios</button>
    <button class="tab-link" data-tab="briefingsTab" type="button">Briefings & AI</button>
    <button class="tab-link" data-tab="exportTab" type="button">Exports</button>
  </nav>

  <main class="app-main">

    <!-- INTRODUCTION -->
    <section id="introTab" class="tab-panel active">
      <div class="grid-two">
        <div class="card">
          <h2>What this tool does</h2>
          <p>
            MANDEVAL helps governments and public health teams compare alternative COVID-19 vaccine
            mandate designs across Australia, France and Italy. It combines preference evidence from a
            multi-country discrete choice experiment with a simple cost‚Äìbenefit framework.
          </p>
          <p>
            You can configure mandate scope and exemptions, choose a coverage threshold to lift the
            mandate, set expected lives saved per 100,000 people, and explore the implications for
            costs, benefits, and predicted public support.
          </p>
        </div>
        <div class="card">
          <h2>How to use it</h2>
          <ol class="plain-list numbered">
            <li>Set the <strong>Settings & assumptions</strong> that apply to your analysis (time horizon, currency, value per life saved).</li>
            <li>Use <strong>Configuration</strong> to pick a country, outbreak scenario, mandate design, population covered, and expected lives saved per 100,000.</li>
            <li>Enter <strong>Costing</strong> inputs for administration, communication, enforcement and support.</li>
            <li>Review <strong>Results &amp; MRS</strong>, save scenarios, and use <strong>Briefings &amp; AI</strong> to generate decision-ready text.</li>
          </ol>
          <p class="note">
            The tool is designed as a transparent framework. All numeric inputs can be replaced with
            country-specific values from epidemiological models, costing work, or regulatory guidance.
          </p>
        </div>
      </div>
    
      <div class="context-banner">
        This decision aid summarises preference and cost‚Äìbenefit evidence from surveys and costing
        assumptions. It does not replace legal, ethical or equity assessments, and it should be
        used alongside local expert advice.
      </div>
</section>

    <!-- DESIGN FEATURES TAB -->
    <section id="designTab" class="tab-panel">
      <div class="card">
        <h2>Mandate design features in the preference study</h2>
        <p>
          The discrete choice experiment asked members of the public in Australia, France and Italy
          to choose between alternative vaccine mandate designs and an opt-out (no mandate) option.
          Each mandate was described using the attributes below.
        </p>

        <div class="design-grid">
          <article class="design-card">
            <div class="design-icon">üè•</div>
            <h3>Scope of the mandate</h3>
            <ul class="plain-list">
              <li><strong>High-risk occupations only</strong><br>
                Vaccination is required only for people in jobs with high exposure risk or essential
                public roles (for example, healthcare workers and emergency responders).</li>
              <li><strong>All occupations &amp; public spaces</strong><br>
                Everyone working or entering public venues (for example, cinemas, malls, restaurants,
                public transport) must be vaccinated.</li>
            </ul>
          </article>

          <article class="design-card">
            <div class="design-icon">üõ°Ô∏è</div>
            <h3>Exemption policy</h3>
            <ul class="plain-list">
              <li><strong>Medical only</strong><br>
                Only those with certified medical reasons (such as serious allergies) can opt out.</li>
              <li><strong>Medical + religious</strong><br>
                Exemptions allowed for medical reasons or documented religious beliefs.</li>
              <li><strong>Medical + religious + personal belief</strong><br>
                Exemptions allowed for medical reasons, religious beliefs, or strong personal
                objections (a broader opt-out).</li>
            </ul>
          </article>

          <article class="design-card">
            <div class="design-icon">üéØ</div>
            <h3>Coverage requirement to lift the mandate</h3>
            <ul class="plain-list">
              <li><strong>50% population vaccinated</strong><br>
                Mandate lifted once 50% of the population is vaccinated (low threshold).</li>
              <li><strong>70% population vaccinated</strong><br>
                Mandate lifted once 70% of the population is vaccinated (most people vaccinated).</li>
              <li><strong>90% population vaccinated</strong><br>
                Mandate lifted once 90% of the population is vaccinated (almost everyone vaccinated).</li>
            </ul>
          </article>

          <article class="design-card">
            <div class="design-icon">‚ù§Ô∏è</div>
            <h3>Estimated lives saved</h3>
            <ul class="plain-list">
              <li><strong>10 lives per 100,000</strong></li>
              <li><strong>25 lives per 100,000</strong></li>
              <li><strong>35 lives per 100,000</strong></li>
              <li><strong>40 lives per 100,000</strong></li>
            </ul>
            <p class="help-text">
              In the tool, you can choose any value from 0‚Äì100 per 100,000 people. The study evidence
              sits mainly in the 10‚Äì40 range.
            </p>
          </article>
        </div>
      </div>
    </section>

    <!-- SETTINGS TAB -->
    <section id="settingsTab" class="tab-panel">
      <div class="card">
        <h2>General settings and assumptions</h2>
        <p>
          Use these settings to define the time horizon, currency and value per life saved used in
          cost‚Äìbenefit calculations and briefings.
        </p>

        <div class="form-grid">
          <div class="form-group">
            <label for="setting-horizon">
              Analysis period
              <span class="info-icon" data-tooltip="Time period over which lives saved and costs are counted (for example, one year).">i</span>
            </label>
            <select id="setting-horizon">
              <option value="1 year">1 year</option>
              <option value="2 years">2 years</option>
              <option value="5 years">5 years</option>
            </select>
          </div>

          <div class="form-group">
            <label for="setting-currency">
              Currency label
              <span class="info-icon" data-tooltip="This label appears next to costs and benefits (for example, AUD, EUR, or generic ‚Äòlocal currency units‚Äô).">i</span>
            </label>
            <input id="setting-currency" type="text" value="local currency units">
          </div>

          <div class="form-group">
            <label for="setting-vsl-scheme">
              Measure for value per life saved
              <span class="info-icon" data-tooltip="Choose the approach used to value each life saved. Numeric values must be entered based on official guidance or your own analysis.">i</span>
            </label>
            <select id="setting-vsl-scheme">
              <option value="vsl">Value of a statistical life (VSL)</option>
              <option value="lifeYear">Value per life-year saved</option>
              <option value="healthSystem">Health system willingness-to-pay threshold</option>
              <option value="custom">Custom metric</option>
            </select>
          </div>

          <div class="form-group">
            <label for="setting-vsl-value">
              Value per life saved (numeric)
              <span class="info-icon" data-tooltip="Enter the value used for one life saved in your analysis, in the chosen currency units. This can be drawn from national regulatory impact guidelines or other agreed sources.">i</span>
            </label>
            <input id="setting-vsl-value" type="number" min="0" step="1000" value="0">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-primary" id="btn-save-settings">Save settings</button>
        </div>
      </div>
    </section>

    <!-- CONFIGURATION TAB -->
    <section id="configTab" class="tab-panel">
      <div class="grid-two">
        <div class="card">
          <h2>Configure mandate scenario</h2>

          <div class="form-grid">
            <div class="form-group">
              <label for="cfg-country">
                Country
                <span class="info-icon" data-tooltip="The country whose context and preference estimates are used in calculations.">i</span>
              </label>
              <select id="cfg-country">
                <option value="">Select‚Ä¶</option>
                <option value="AU">Australia</option>
                <option value="FR">France</option>
                <option value="IT">Italy</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cfg-outbreak">
                Outbreak scenario
                <span class="info-icon" data-tooltip="Mild or severe epidemiological scenario, consistent with the choice experiment framing.">i</span>
              </label>
              <select id="cfg-outbreak">
                <option value="mild">Mild</option>
                <option value="severe">Severe</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cfg-scope">
                Scope of mandate
                <span class="info-icon" data-tooltip="Whether mandates apply only to high-risk occupations or to all occupations and public spaces.">i</span>
              </label>
              <select id="cfg-scope">
                <option value="highrisk">High-risk occupations only</option>
                <option value="all">All occupations and public spaces</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cfg-exemptions">
                Exemption policy
                <span class="info-icon" data-tooltip="The grounds on which people can be exempted from the mandate (medical only, medical + religious, or broader personal belief exemptions).">i</span>
              </label>
              <select id="cfg-exemptions">
                <option value="medical">Medical only</option>
                <option value="medrel">Medical + religious</option>
                <option value="medrelpers">Medical + religious + personal belief</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cfg-coverage">
                Coverage requirement to lift mandate
                <span class="info-icon" data-tooltip="Vaccination coverage threshold at which the mandate is lifted (50%, 70%, or 90% of the population).">i</span>
              </label>
              <select id="cfg-coverage">
                <option value="0.5">50%</option>
                <option value="0.7">70%</option>
                <option value="0.9">90%</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cfg-pop">
                Population covered (millions)
                <span class="info-icon" data-tooltip="Number of people directly covered by the mandate, in millions. Used to scale expected lives saved and total costs.">i</span>
              </label>
              <input id="cfg-pop" type="number" min="0" step="0.1" value="1.0">
            </div>

            <div class="form-group">
              <label for="cfg-lives">
                Expected lives saved per 100,000
                <span class="info-icon" data-tooltip="Estimated number of deaths averted per 100,000 people under this mandate design, over the chosen analysis period.">i</span>
              </label>
              <input id="cfg-lives" type="range" min="0" max="100" step="1" value="25">
              <div class="range-value">
                <span id="cfg-lives-display">25</span> lives saved per 100,000 people
                <span class="help-text">The preference study used 10‚Äì40 per 100,000; values outside this range require additional justification.</span>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-primary" id="btn-apply-config">Apply configuration</button>
            <button type="button" class="btn-secondary" id="btn-save-scenario">Save scenario</button>
          </div>
        </div>

        <div class="card">
          <h2>Current configuration at a glance</h2>
          <div id="cfg-summary-empty" class="muted">
            No configuration applied yet. Configure country, outbreak scenario and design, then click
            <strong>Apply configuration</strong> to see a summary.
          </div>
          <div id="cfg-summary-panel" class="summary-grid" hidden>
            <div>
              <h3>Context</h3>
              <p><strong>Country:</strong> <span id="cfg-summary-country">‚Äì</span></p>
              <p><strong>Outbreak:</strong> <span id="cfg-summary-outbreak">‚Äì</span></p>
              <p><strong>Population covered:</strong> <span id="cfg-summary-pop">‚Äì</span></p>
            </div>
            <div>
              <h3>Mandate design</h3>
              <p><strong>Scope:</strong> <span id="cfg-summary-scope">‚Äì</span></p>
              <p><strong>Exemptions:</strong> <span id="cfg-summary-exemptions">‚Äì</span></p>
              <p><strong>Coverage to lift mandate:</strong> <span id="cfg-summary-coverage">‚Äì</span></p>
              <p><strong>Expected lives saved:</strong> <span id="cfg-summary-lives">‚Äì</span></p>
            </div>
            <div>
              <h3>Model-based public support</h3>
              <p>
                <strong>Predicted support:</strong>
                <span id="cfg-summary-support">‚Äì</span>
                <span class="info-icon" data-tooltip="Predicted proportion of people who would choose a mandate like this over no mandate, based on the mixed logit estimates for the selected country and outbreak scenario.">i</span>
              </p>
            </div>
          </div>

          <div class="headline-block">
            <h3>Headline recommendation</h3>
            <p id="headline-text">
              Apply a configuration to see a concise recommendation that combines predicted public
              support, mandate design features, indicative costs, benefits and expected public support.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- COSTING TAB -->
    <section id="costsTab" class="tab-panel">
      <div class="card">
        <h2>Costing of the mandate</h2>
        <p>
          Enter approximate costs associated with implementing this mandate. All amounts are in the
          currency defined in the <strong>Settings &amp; assumptions</strong> tab.
        </p>

        <div class="form-grid">
          <div class="form-group">
            <label for="cost-admin">
              Programme administration
              <span class="info-icon" data-tooltip="Central coordination, staff time in ministries and public health agencies, and core programme management costs.">i</span>
            </label>
            <input id="cost-admin" type="number" min="0" step="1000" value="0">
          </div>

          <div class="form-group">
            <label for="cost-comm">
              Communication and engagement
              <span class="info-icon" data-tooltip="Information campaigns, outreach to affected groups, and public communication to explain the mandate.">i</span>
            </label>
            <input id="cost-comm" type="number" min="0" step="1000" value="0">
          </div>

          <div class="form-group">
            <label for="cost-enforce">
              Enforcement and compliance
              <span class="info-icon" data-tooltip="Checking vaccination status, penalties for non-compliance, inspections, and related legal or administrative costs.">i</span>
            </label>
            <input id="cost-enforce" type="number" min="0" step="1000" value="0">
          </div>

          <div class="form-group">
            <label for="cost-it">
              Digital systems and certification
              <span class="info-icon" data-tooltip="IT systems for certificates or passes, data integration, QR code infrastructure, and system maintenance.">i</span>
            </label>
            <input id="cost-it" type="number" min="0" step="1000" value="0">
          </div>

          <div class="form-group">
            <label for="cost-support">
              Compensation and support
              <span class="info-icon" data-tooltip="Compensation for vaccine injury, hardship support for affected workers or sectors, and resources to manage exemption requests.">i</span>
            </label>
            <input id="cost-support" type="number" min="0" step="1000" value="0">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-primary" id="btn-apply-costs">Apply costs</button>
        </div>

        <div class="summary-grid cost-summary">
          <div>
            <h3>Total implementation cost</h3>
            <p><strong><span id="cost-total">‚Äì</span></strong></p>
          </div>
          <div>
            <h3>Cost per 100,000 people</h3>
            <p><strong><span id="cost-per-100k">‚Äì</span></strong></p>
          </div>
          <div>
            <h3>Cost per 1 million people</h3>
            <p><strong><span id="cost-per-1m">‚Äì</span></strong></p>
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTS TAB -->
    <section id="resultsTab" class="tab-panel">
      <div class="card">
        <h2>Results, cost‚Äìbenefit and lives-saved equivalents</h2>
        <p>
          This page shows the cost‚Äìbenefit profile of the current configuration and the marginal
          rates of substitution (MRS) between mandate design features and expected lives saved.
        </p>

        
<div class="summary-grid">
          <div>
            <h3>Current configuration</h3>
            <p><strong>BCR:</strong> <span id="result-bcr">‚Äì</span></p>
            <p><strong>Net benefit:</strong> <span id="result-net-benefit">‚Äì</span></p>
            <p><strong>Predicted support:</strong> <span id="result-support">‚Äì</span></p>
            <p><strong>Lives saved (total):</strong> <span id="result-lives-total">‚Äì</span></p>
            <div class="chip-row">
              <span class="chip" id="chip-support">Support: ‚Äì</span>
              <span class="chip" id="chip-bcr">BCR: ‚Äì</span>
              <span class="chip" id="chip-data">Data: ‚Äì</span>
            </div>
          </div>
          <div>
            <h3>Top policy options (saved scenarios)</h3>
            <p class="help-text">
              Save one or more scenarios from the <strong>Configuration</strong> tab to see them
              ranked here by benefit‚Äìcost ratio (BCR), and cross-checked against predicted support.
            </p>
            <div class="card card-nested">
              <h4>Support versus opt-out</h4>
              <p class="small-muted">
                Predicted share of adults who would support this mandate versus preferring no mandate,
                under the current assumptions.
              </p>
              <div class="chart-container chart-container-small">
                <canvas id="supportChart" aria-label="Support versus opt-out chart"></canvas>
              </div>
            </div>
          </div>
        </div>

<div class="table-wrapper">
          <table class="table" id="results-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Label</th>
                <th>Country</th>
                <th>Outbreak</th>
                <th>Scope</th>
                <th>Exemptions</th>
                <th>Coverage</th>
                <th>BCR</th>
                <th>Net benefit</th>
                <th>Predicted support</th>
              </tr>
            </thead>
            <tbody>
              <tr class="empty-row">
                <td colspan="10">No saved scenarios yet. Configure a mandate and click <strong>Save scenario</strong>.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="card">
          <h3>Lives-saved equivalents (MRS) for this configuration</h3>
          <p>
            For each attribute, the marginal rate of substitution (MRS) is defined as:
          </p>
          <p class="math">
            MRS<sub>k</sub> = ‚àí Œ≤<sub>k</sub> / Œ≤<sub>lives</sub>
          </p>
          <p>
            This represents the change in expected lives saved (per 100,000 people) that yields the
            same change in deterministic utility as a one-unit change in attribute <em>k</em>, holding
            other attributes constant.
          </p>
          <div class="table-wrapper">
            <table class="table" id="mrs-table">
              <thead>
                <tr>
                  <th>Attribute change</th>
                  <th>MRS (lives per 100,000)</th>
                  <th>Interpretation</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty-row">
                  <td colspan="3">Apply a configuration to see lives-saved equivalents for the chosen design.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="chart-container">
            <canvas id="mrsChart" aria-label="Lives-saved equivalents chart"></canvas>
          </div>
        </div>
      </div>
    
      
        <div class="card">
          <h3>Notes and distributional considerations</h3>
          <p class="small-muted">
            Optional: record legal, ethical or political constraints, or which groups are most
            affected. These notes are stored with the scenario and included in exports.
          </p>
          <textarea id="result-notes" rows="3" class="full-width"></textarea>
        </div>
<div class="context-banner">
        Remember: this tool provides structured evidence on support, costs and benefits for vaccine
        mandates. Final decisions should also reflect legal obligations, ethical principles and the
        distribution of impacts across groups.
      </div>
</section>

    <!-- SAVED SCENARIOS TAB -->
    <section id="scenariosTab" class="tab-panel">
      <div class="card">
        <h2>Saved scenarios</h2>
        <p>
          Each saved scenario captures a complete configuration, including costs, benefits and
          predicted public support. Use this table to compare options side by side.
        </p>
        <div class="table-wrapper">
          <table class="table" id="scenarios-table">
            <thead>
              <tr>
                <th>Label</th>
                <th>Country</th>
                <th>Outbreak</th>
                <th>Scope</th>
                <th>Exemptions</th>
                <th>Coverage</th>
                <th>BCR</th>
                <th>Net benefit</th>
                <th>Predicted support</th>
                <th>Pin</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr class="empty-row">
                <td colspan="10">No scenarios saved yet.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- BRIEFINGS & AI TAB -->
    <section id="briefingsTab" class="tab-panel">
      <div class="grid-two">
        <div class="card">
          <h2>Briefing text (copy into emails or reports)</h2>
          <p>
            This text summarises the current configuration using the settings, costs, benefits and
            model-based public support. You can refine it further for local context.
          </p>
          <textarea id="briefing-text" rows="12"></textarea>
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="btn-copy-briefing">Copy briefing text</button>
          </div>
        </div>
        <div class="card">
          <h2>AI-ready prompts</h2>
          <p>
            Use these buttons to copy a structured prompt and open Copilot or ChatGPT in a new
            window, ready for pasting. The prompt includes the current configuration and, where
            available, the top ranked scenarios.
          </p>
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="btn-open-copilot">Copy prompt and open Copilot</button>
            <button type="button" class="btn-secondary" id="btn-open-chatgpt">Copy prompt and open ChatGPT</button>
          </div>
        </div>
      </div>
    </section>

    <!-- EXPORTS TAB -->
    <section id="exportTab" class="tab-panel">
      <div class="grid-two">
        <div class="card">
          <h2>Export data</h2>
          <p>Export scenario data for further analysis or archiving.</p>
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="btn-export-excel">Export scenarios (Excel)</button>
            <button type="button" class="btn-secondary" id="btn-export-csv">Export scenarios (CSV)</button>
            <button type="button" class="btn-secondary" id="btn-export-pdf">Export summary (PDF)</button>
            <button type="button" class="btn-secondary" id="btn-export-word">Export briefing (Word)</button>
          </div>
        </div>
        <div class="card">
          <h2>Clear local data</h2>
          <p>
            MANDEVAL stores your configurations only in this browser (local storage). Use the button
            below if you want to clear all saved scenarios on this device.
          </p>
          <div class="form-actions">
            <button type="button" class="btn-tertiary" id="btn-clear-storage">Clear saved scenarios</button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <div id="toast-container"></div>

</body>
</html>
